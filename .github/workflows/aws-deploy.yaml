name: Deploy to AWS

on:
    push:
        branches:
            - main
        paths:
            - .github/workflows/aws-deploy.yaml

jobs:
    build-and-push:
        name: Deploy to AWS ECS
        runs-on: ubuntu-latest
        steps:
            - name: Checkout Code
              uses: actions/checkout@v2

            - name: Set up Docker Buildx
              uses: docker/setup-buildx-action@v2

            - name: login to DockerHub
              uses: docker/login-action@v2
              with:
                username: ${{ secrets.DOCKERHUB_USER }}
                password: ${{ secrets.DOCKERHUB_PASSWORD }}
    
    deploy-to-ec2:
        runs-on: ubuntu-latest
        needs: build-and-push
        steps:
          - name: set up ssh
            uses: webfactory/ssh-agent@v0.5.3
            with:
              ssh-private-key: ${{ secrets.EC2_SSH_kEY }}
            
            